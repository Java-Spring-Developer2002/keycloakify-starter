{"version":3,"file":"static/js/930.3b070a9f.chunk.js","mappings":"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","sources":["App/logo.svg","App/oidc.tsx","App/App.tsx","App/index.ts","keycloak-theme/valuesTransferredOverUrl.ts"],"sourcesContent":["var _g;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgLogo(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 841.9 595.3\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"#61DAFB\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M666.3 296.5c0-32.5-40.7-63.3-103.1-82.4 14.4-63.6 8-114.2-20.2-130.4-6.5-3.8-14.1-5.6-22.4-5.6v22.3c4.6 0 8.3.9 11.4 2.6 13.6 7.8 19.5 37.5 14.9 75.7-1.1 9.4-2.9 19.3-5.1 29.4-19.6-4.8-41-8.5-63.5-10.9-13.5-18.5-27.5-35.3-41.6-50 32.6-30.3 63.2-46.9 84-46.9V78c-27.5 0-63.5 19.6-99.9 53.6-36.4-33.8-72.4-53.2-99.9-53.2v22.3c20.7 0 51.4 16.5 84 46.6-14 14.7-28 31.4-41.3 49.9-22.6 2.4-44 6.1-63.6 11-2.3-10-4-19.7-5.2-29-4.7-38.2 1.1-67.9 14.6-75.8 3-1.8 6.9-2.6 11.5-2.6V78.5c-8.4 0-16 1.8-22.6 5.6-28.1 16.2-34.4 66.7-19.9 130.1-62.2 19.2-102.7 49.9-102.7 82.3 0 32.5 40.7 63.3 103.1 82.4-14.4 63.6-8 114.2 20.2 130.4 6.5 3.8 14.1 5.6 22.5 5.6 27.5 0 63.5-19.6 99.9-53.6 36.4 33.8 72.4 53.2 99.9 53.2 8.4 0 16-1.8 22.6-5.6 28.1-16.2 34.4-66.7 19.9-130.1 62-19.1 102.5-49.9 102.5-82.3zm-130.2-66.7c-3.7 12.9-8.3 26.2-13.5 39.5-4.1-8-8.4-16-13.1-24-4.6-8-9.5-15.8-14.4-23.4 14.2 2.1 27.9 4.7 41 7.9zm-45.8 106.5c-7.8 13.5-15.8 26.3-24.1 38.2-14.9 1.3-30 2-45.2 2-15.1 0-30.2-.7-45-1.9-8.3-11.9-16.4-24.6-24.2-38-7.6-13.1-14.5-26.4-20.8-39.8 6.2-13.4 13.2-26.8 20.7-39.9 7.8-13.5 15.8-26.3 24.1-38.2 14.9-1.3 30-2 45.2-2 15.1 0 30.2.7 45 1.9 8.3 11.9 16.4 24.6 24.2 38 7.6 13.1 14.5 26.4 20.8 39.8-6.3 13.4-13.2 26.8-20.7 39.9zm32.3-13c5.4 13.4 10 26.8 13.8 39.8-13.1 3.2-26.9 5.9-41.2 8 4.9-7.7 9.8-15.6 14.4-23.7 4.6-8 8.9-16.1 13-24.1zM421.2 430c-9.3-9.6-18.6-20.3-27.8-32 9 .4 18.2.7 27.5.7 9.4 0 18.7-.2 27.8-.7-9 11.7-18.3 22.4-27.5 32zm-74.4-58.9c-14.2-2.1-27.9-4.7-41-7.9 3.7-12.9 8.3-26.2 13.5-39.5 4.1 8 8.4 16 13.1 24 4.7 8 9.5 15.8 14.4 23.4zM420.7 163c9.3 9.6 18.6 20.3 27.8 32-9-.4-18.2-.7-27.5-.7-9.4 0-18.7.2-27.8.7 9-11.7 18.3-22.4 27.5-32zm-74 58.9c-4.9 7.7-9.8 15.6-14.4 23.7-4.6 8-8.9 16-13 24-5.4-13.4-10-26.8-13.8-39.8 13.1-3.1 26.9-5.8 41.2-7.9zm-90.5 125.2c-35.4-15.1-58.3-34.9-58.3-50.6 0-15.7 22.9-35.6 58.3-50.6 8.6-3.7 18-7 27.7-10.1 5.7 19.6 13.2 40 22.5 60.9-9.2 20.8-16.6 41.1-22.2 60.6-9.9-3.1-19.3-6.5-28-10.2zM310 490c-13.6-7.8-19.5-37.5-14.9-75.7 1.1-9.4 2.9-19.3 5.1-29.4 19.6 4.8 41 8.5 63.5 10.9 13.5 18.5 27.5 35.3 41.6 50-32.6 30.3-63.2 46.9-84 46.9-4.5-.1-8.3-1-11.3-2.7zm237.2-76.2c4.7 38.2-1.1 67.9-14.6 75.8-3 1.8-6.9 2.6-11.5 2.6-20.7 0-51.4-16.5-84-46.6 14-14.7 28-31.4 41.3-49.9 22.6-2.4 44-6.1 63.6-11 2.3 10.1 4.1 19.8 5.2 29.1zm38.5-66.7c-8.6 3.7-18 7-27.7 10.1-5.7-19.6-13.2-40-22.5-60.9 9.2-20.8 16.6-41.1 22.2-60.6 9.9 3.1 19.3 6.5 28.1 10.2 35.4 15.1 58.3 34.9 58.3 50.6-.1 15.7-23 35.6-58.4 50.6zM320.8 78.4z\"\n  }), /*#__PURE__*/React.createElement(\"circle\", {\n    cx: 420.9,\n    cy: 296.5,\n    r: 45.7\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M520.5 78.1z\"\n  }))));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgLogo);\nexport default __webpack_public_path__ + \"static/media/logo.6ce24c58023cc2f8fd88fe9d219db6c6.svg\";\nexport { ForwardRef as ReactComponent };","import { useState, useContext, createContext, useEffect } from \"react\";\r\nimport keycloak_js from \"keycloak-js\";\r\nimport { id } from \"tsafe/id\";\r\nimport { addParamToUrl } from \"powerhooks/tools/urlSearchParams\";\r\nimport type { ReturnType } from \"tsafe/ReturnType\";\r\nimport type { Param0 } from \"tsafe/Param0\";\r\nimport { assert } from \"tsafe/assert\";\r\nimport { createKeycloakAdapter } from \"keycloakify\";\r\nimport type { NonPostableEvt } from \"evt\";\r\nimport jwt_decode from \"jwt-decode\";\r\n\r\nexport declare type OidcClient = OidcClient.LoggedIn | OidcClient.NotLoggedIn;\r\n\r\nexport declare namespace OidcClient {\r\n    export type NotLoggedIn = {\r\n        isUserLoggedIn: false;\r\n        login: (params: {\r\n            //To prevent infinite loop if the user click login then cancel.\r\n            doesCurrentHrefRequiresAuth: boolean;\r\n        }) => Promise<never>;\r\n    };\r\n\r\n    export type LoggedIn = {\r\n        isUserLoggedIn: true;\r\n        //NOTE: It changes when renewed, don't store it.\r\n        accessToken: string;\r\n        logout: (params: { redirectTo: \"home\" | \"current page\" }) => Promise<never>;\r\n        updateTokenInfo: () => Promise<void>;\r\n    };\r\n}\r\n\r\ntype Params = {\r\n    url: string;\r\n    realm: string;\r\n    clientId: string;\r\n    transformUrlBeforeRedirect: (url: string) => string;\r\n    evtUserActivity: NonPostableEvt<void>;\r\n    getUiLocales: () => string;\r\n    log?: typeof console.log;\r\n};\r\n\r\nasync function createKeycloakOidcClient(params: Params): Promise<OidcClient> {\r\n    const {\r\n        url,\r\n        realm,\r\n        clientId,\r\n        transformUrlBeforeRedirect,\r\n        evtUserActivity,\r\n        getUiLocales,\r\n        log\r\n    } = params;\r\n\r\n    const keycloakInstance = keycloak_js({ url, realm, clientId });\r\n\r\n    let redirectMethod: ReturnType<\r\n        Param0<typeof createKeycloakAdapter>[\"getRedirectMethod\"]\r\n    > = \"overwrite location.href\";\r\n\r\n    const isAuthenticated = await keycloakInstance\r\n        .init({\r\n            onLoad: \"check-sso\",\r\n            silentCheckSsoRedirectUri: `${window.location.origin}/silent-sso.html`,\r\n            responseMode: \"query\",\r\n            checkLoginIframe: false,\r\n            adapter: createKeycloakAdapter({\r\n                transformUrlBeforeRedirect: url =>\r\n                    [url].map(transformUrlBeforeRedirect).map(\r\n                        url =>\r\n                            addParamToUrl({\r\n                                url,\r\n                                \"name\": \"ui_locales\",\r\n                                \"value\": getUiLocales()\r\n                            }).newUrl\r\n                    )[0],\r\n                keycloakInstance,\r\n                getRedirectMethod: () => redirectMethod\r\n            })\r\n        })\r\n        .catch((error: Error) => error);\r\n\r\n    //TODO: Make sure that result is always an object.\r\n    if (isAuthenticated instanceof Error) {\r\n        throw isAuthenticated;\r\n    }\r\n\r\n    const login: OidcClient.NotLoggedIn[\"login\"] = async ({\r\n        doesCurrentHrefRequiresAuth\r\n    }) => {\r\n        if (doesCurrentHrefRequiresAuth) {\r\n            redirectMethod = \"location.replace\";\r\n        }\r\n\r\n        await keycloakInstance.login({ \"redirectUri\": window.location.href });\r\n\r\n        return new Promise<never>(() => { });\r\n    };\r\n\r\n    if (!isAuthenticated) {\r\n        return id<OidcClient.NotLoggedIn>({\r\n            \"isUserLoggedIn\": false,\r\n            login\r\n        });\r\n    }\r\n\r\n    const oidcClient = id<OidcClient.LoggedIn>({\r\n        \"isUserLoggedIn\": true,\r\n        \"accessToken\": keycloakInstance.token!,\r\n        \"logout\": async ({ redirectTo }) => {\r\n            await keycloakInstance.logout({\r\n                \"redirectUri\": (() => {\r\n                    switch (redirectTo) {\r\n                        case \"current page\":\r\n                            return window.location.href;\r\n                        case \"home\":\r\n                            return window.location.origin;\r\n                    }\r\n                })()\r\n            });\r\n\r\n            return new Promise<never>(() => { });\r\n        },\r\n        \"updateTokenInfo\": async () => {\r\n            await keycloakInstance.updateToken(-1);\r\n\r\n            oidcClient.accessToken = keycloakInstance.token!;\r\n        }\r\n    });\r\n\r\n    (function callee() {\r\n        const msBeforeExpiration =\r\n            jwt_decode<{ exp: number }>(oidcClient.accessToken)[\"exp\"] * 1000 - Date.now();\r\n\r\n        setTimeout(async () => {\r\n            log?.(\r\n                `OIDC access token will expire in ${minValiditySecond} seconds, waiting for user activity before renewing`\r\n            );\r\n\r\n            await evtUserActivity.waitFor();\r\n\r\n            log?.(\"User activity detected. Refreshing access token now\");\r\n\r\n            const error = await keycloakInstance.updateToken(-1).then(\r\n                () => undefined,\r\n                (error: Error) => error\r\n            );\r\n\r\n            if (error) {\r\n                log?.(\"Can't refresh OIDC access token, getting a new one\");\r\n                //NOTE: Never resolves\r\n                await login({ \"doesCurrentHrefRequiresAuth\": true });\r\n            }\r\n\r\n            oidcClient.accessToken = keycloakInstance.token!;\r\n\r\n            callee();\r\n        }, msBeforeExpiration - minValiditySecond * 1000);\r\n    })();\r\n\r\n    return oidcClient;\r\n}\r\n\r\nconst minValiditySecond = 25;\r\n\r\n\r\nconst oidcClientContext = createContext<OidcClient | undefined>(undefined);\r\n\r\nexport function createOidcClientProvider(params: Params) {\r\n\r\n\r\n    const prOidcClient = createKeycloakOidcClient(params);\r\n\r\n    function OidcClientProvider(props: { children: React.ReactNode; }) {\r\n\r\n        const { children } = props;\r\n\r\n        const [oidcClient, setOidcClient] = useState<OidcClient | undefined>(undefined);\r\n\r\n        useEffect(() => {\r\n\r\n            prOidcClient.then(setOidcClient);\r\n\r\n        }, []);\r\n\r\n        if (oidcClient === undefined) {\r\n            return null;\r\n        }\r\n\r\n        return (\r\n            <oidcClientContext.Provider value={oidcClient}>\r\n                {children}\r\n            </oidcClientContext.Provider>\r\n        );\r\n\r\n    }\r\n\r\n\r\n\r\n    return { OidcClientProvider };\r\n\r\n}\r\n\r\nexport function useOidcClient() {\r\n    const oidcClient = useContext(oidcClientContext);\r\n    assert(oidcClient !== undefined);\r\n    return { oidcClient };\r\n}\r\n","import \"./App.css\";\r\nimport logo from \"./logo.svg\";\r\nimport myimg from \"./myimg.png\";\r\nimport { createOidcClientProvider, useOidcClient } from \"./oidc\";\r\nimport { addFooToQueryParams, addBarToQueryParams } from \"../keycloak-theme/valuesTransferredOverUrl\";\r\nimport { Evt } from \"evt\";\r\nimport { id } from \"tsafe/id\";\r\nimport jwt_decode from \"jwt-decode\";\r\n\r\nconst { OidcClientProvider } = createOidcClientProvider({\r\n    url: \"https://auth.code.gouv.fr/auth\",\r\n    realm: \"keycloakify\",\r\n    clientId: \"starter\",\r\n    log: console.log,\r\n    //The login pages will be in english.\r\n    getUiLocales: () => \"en\",\r\n    transformUrlBeforeRedirect: url =>\r\n        [url]\r\n            //Instead of foo and bar you could have isDark for example or any other state that you wish to \r\n            //transfer from the main app to the login pages.\r\n            .map(url => addFooToQueryParams({ url, value: { foo: 42 } }))\r\n            .map(url => addBarToQueryParams({ url, value: \"value of bar transferred to login page\" }))\r\n        [0],\r\n    // An event emitter that posts whenever the user interacts with the app\r\n    // This is to tell if we should allow the token to expires.  \r\n    evtUserActivity:\r\n        Evt.merge([\r\n            Evt.from(document, \"mousemove\"),\r\n            Evt.from(document, \"keydown\")\r\n        ]).pipe(() => [id<void>(undefined)]),\r\n});\r\n\r\nexport default function App() {\r\n    return (\r\n        <OidcClientProvider>\r\n            <ContextualizedApp />\r\n        </OidcClientProvider>\r\n    );\r\n\r\n}\r\n\r\nfunction ContextualizedApp() {\r\n\r\n    const { oidcClient } = useOidcClient();\r\n\r\n    return (\r\n        <div className=\"App\">\r\n            <header className=\"App-header\">\r\n            {\r\n                oidcClient.isUserLoggedIn ?\r\n                    <>\r\n                        <h1>You are authenticated</h1>\r\n                        <pre>{JSON.stringify(jwt_decode(oidcClient.accessToken))}</pre>\r\n                        <button onClick={() => oidcClient.logout({ redirectTo: \"home\" })}>Logout</button>\r\n                    </>\r\n                    :\r\n                    <>\r\n                        <button onClick={() => oidcClient.login({ doesCurrentHrefRequiresAuth: false })}>Login</button>\r\n                    </>\r\n            }\r\n                <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n                <img src={myimg} alt=\"test_image\" />\r\n                <p style={{ \"fontFamily\": '\"Work Sans\"' }}>Hello world</p>\r\n            </header>\r\n        </div>\r\n    );\r\n}\r\n","import App from \"./App\";\r\nexport * from \"./App\";\r\n\r\nexport default App;\r\n","import { kcContext } from \"./kcContext\";\r\nimport {\r\n    retrieveParamFromUrl,\r\n    addParamToUrl,\r\n    updateSearchBarUrl\r\n} from \"powerhooks/tools/urlSearchParams\";\r\nimport { capitalize } from \"tsafe/capitalize\";\r\n\r\nexport const { foo, addFooToQueryParams } = (() => {\r\n    const queryParamName = \"foo\";\r\n\r\n    type Type = { foo: number; };\r\n\r\n    const value = (()=> {\r\n\r\n        const unparsedValue = read({ queryParamName });\r\n\r\n        if( unparsedValue === undefined ){\r\n            return undefined;\r\n        }\r\n\r\n        return JSON.parse(unparsedValue) as Type;\r\n\r\n    })();\r\n\r\n    function addToUrlQueryParams(params: {\r\n        url: string;\r\n        value: Type;\r\n    }): string {\r\n        const { url, value } = params;\r\n\r\n        return addParamToUrl({\r\n            url,\r\n            \"name\": queryParamName,\r\n            \"value\": JSON.stringify(value)\r\n        }).newUrl;\r\n    }\r\n\r\n    const out = {\r\n        [queryParamName]: value,\r\n        [`add${capitalize(queryParamName)}ToQueryParams` as const]: addToUrlQueryParams\r\n    } as const;\r\n\r\n    return out;\r\n})();\r\n\r\nexport const { bar, addBarToQueryParams } = (() => {\r\n    const queryParamName = \"bar\";\r\n\r\n    type Type = string;\r\n\r\n    const value = (()=> {\r\n\r\n        const unparsedValue = read({ queryParamName });\r\n\r\n        if( unparsedValue === undefined ){\r\n            return undefined;\r\n        }\r\n\r\n        return JSON.parse(unparsedValue) as Type;\r\n\r\n    })();\r\n\r\n    function addToUrlQueryParams(params: {\r\n        url: string;\r\n        value: Type;\r\n    }): string {\r\n        const { url, value } = params;\r\n\r\n        return addParamToUrl({\r\n            url,\r\n            \"name\": queryParamName,\r\n            \"value\": JSON.stringify(value)\r\n        }).newUrl;\r\n    }\r\n\r\n    const out = {\r\n        [queryParamName]: value,\r\n        [`add${capitalize(queryParamName)}ToQueryParams` as const]: addToUrlQueryParams\r\n    } as const;\r\n\r\n    return out;\r\n})();\r\n\r\n\r\nfunction read(params: { queryParamName: string }): string | undefined {\r\n    if (kcContext === undefined || process.env.NODE_ENV !== \"production\") {\r\n        //NOTE: We do something only if we are really in Keycloak\r\n        return undefined;\r\n    }\r\n\r\n    const { queryParamName } = params;\r\n\r\n    read_from_url: {\r\n        const result = retrieveParamFromUrl({\r\n            \"url\": window.location.href,\r\n            \"name\": queryParamName\r\n        });\r\n\r\n        if (!result.wasPresent) {\r\n            break read_from_url;\r\n        }\r\n\r\n        const { newUrl, value: serializedValue } = result;\r\n\r\n        updateSearchBarUrl(newUrl);\r\n\r\n        localStorage.setItem(queryParamName, serializedValue);\r\n\r\n        return serializedValue;\r\n    }\r\n\r\n    //Reading from local storage\r\n    const serializedValue = localStorage.getItem(queryParamName);\r\n\r\n    if (serializedValue === null) {\r\n        throw new Error(\r\n            `Missing ${queryParamName} in URL when redirecting to login page`\r\n        );\r\n    }\r\n\r\n    return serializedValue;\r\n}\r\n"],"names":["createKeycloakOidcClient","params","url","realm","clientId","transformUrlBeforeRedirect","evtUserActivity","getUiLocales","log","keycloakInstance","keycloak_js","redirectMethod","init","onLoad","silentCheckSsoRedirectUri","window","location","origin","responseMode","checkLoginIframe","adapter","createKeycloakAdapter","map","addParamToUrl","newUrl","getRedirectMethod","catch","error","isAuthenticated","Error","login","doesCurrentHrefRequiresAuth","href","Promise","id","oidcClient","token","redirectTo","logout","updateToken","accessToken","callee","msBeforeExpiration","jwt_decode","Date","now","setTimeout","minValiditySecond","waitFor","then","oidcClientContext","createContext","undefined","prOidcClient","OidcClientProvider","props","children","useState","setOidcClient","useEffect","Provider","value","createOidcClientProvider","console","addFooToQueryParams","foo","addBarToQueryParams","Evt","document","pipe","ContextualizedApp","useContext","assert","useOidcClient","className","isUserLoggedIn","JSON","stringify","onClick","src","logo","alt","style","queryParamName","unparsedValue","read","parse","out","capitalize","bar","kcContext","result","retrieveParamFromUrl","wasPresent","serializedValue","updateSearchBarUrl","localStorage","setItem","getItem"],"sourceRoot":""}